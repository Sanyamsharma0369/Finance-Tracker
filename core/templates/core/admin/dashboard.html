{% extends 'core/admin/admin_base.html' %}
{% load static %}

{% block title %}Admin Dashboard | Finance Tracker{% endblock %}
{% block header %}Admin Dashboard{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
    /* Modern dashboard styles with improved visual hierarchy */
    .stats-icon {
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 16px;
        font-size: 24px;
        transition: all 0.3s ease;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    
    .stats-icon:hover {
        transform: translateY(-5px);
    }
    
    .action-link:hover i.fa-arrow-right {
        transform: translateX(5px);
        transition: transform 0.3s ease;
    }
    
    .welcome-banner {
        background: linear-gradient(135deg, #4a6baf 0%, #1e2a45 100%);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    .stat-badge {
        font-size: 1.1rem;
        padding: 0.4rem 0.8rem;
        font-weight: 700;
        border-radius: 12px;
    }
    
    .admin-action-list .list-group-item {
        background-color: rgba(255, 255, 255, 0.03);
        border-color: rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
        border-radius: 12px;
        margin-bottom: 8px;
    }
    
    .admin-action-list .list-group-item:hover {
        background-color: rgba(255, 255, 255, 0.08);
        transform: translateX(5px);
    }
    
    /* Task cards styling */
    .task-card {
        transition: all 0.3s ease;
        border-radius: 16px;
    }
    
    .task-card:hover {
        transform: translateY(-5px);
    }
    
    .bg-gradient-primary {
        background: linear-gradient(135deg, #3a7bd5 0%, #1c4584 100%);
    }
    
    .bg-gradient-danger {
        background: linear-gradient(135deg, #f5365c 0%, #d81b60 100%);
    }
    
    /* Progress bars */
    .progress {
        background-color: rgba(255, 255, 255, 0.1);
        height: 10px;
        border-radius: 5px;
        overflow: hidden;
    }
    
    .progress-bar {
        border-radius: 5px;
    }
    
    /* Modern card styling */
    .card {
        border-radius: 16px;
        border: none;
        overflow: hidden;
    }
    
    .card-header {
        background-color: rgba(255, 255, 255, 0.05);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        padding: 1.25rem 1.5rem;
    }
    
    /* Flat buttons */
    .btn {
        border-radius: 12px;
        font-weight: 600;
        letter-spacing: 0.5px;
        padding: 0.6rem 1.2rem;
        border: none;
        box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    
    .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    .btn-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        padding: 0;
    }
    
    /* Animation for cards */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .animated-card {
        animation: fadeIn 0.5s ease forwards;
    }
    
    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }
    .delay-3 { animation-delay: 0.3s; }
    .delay-4 { animation-delay: 0.4s; }
</style>
{% endblock %}

{% block content %}
<!-- Modern Admin Dashboard with Flat Design -->
<div class="admin-dashboard">
    <!-- Welcome Banner with Modern Design -->
    <div class="card welcome-banner shadow mb-4 animated-card">
        <div class="card-body p-0">
            <div class="row g-0">
                <div class="col-lg-8 p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-lg bg-white p-3 me-3 shadow-sm">
                            <i class="fas fa-shield-alt fa-2x text-primary"></i>
    </div>
                        <div>
                            <h2 class="text-white mb-0 fw-bold">Welcome, {{ user.username }}</h2>
                            <p class="text-white-50 mb-0">You have full administrative access to the system</p>
        </div>
    </div>
                    <div class="alert bg-white bg-opacity-10 text-white border-0 rounded-3 mb-0">
                        <i class="fas fa-info-circle me-2"></i> 
                        You can manage all aspects of the Finance Tracker system, including users, transactions, budgets, goals, and more.
                    </div>
                </div>
                <div class="col-lg-4 d-none d-lg-block position-relative overflow-hidden">
                    <div class="position-absolute top-0 end-0 w-100 h-100 d-flex align-items-center justify-content-center">
                        <div class="bg-white bg-opacity-10 rounded-circle" style="width: 350px; height: 350px; transform: translate(30%, -30%);"></div>
                        <div class="bg-white bg-opacity-05 rounded-circle" style="width: 200px; height: 200px; position: absolute; bottom: -50px; left: 0px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Diagnostic Action Button -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow bg-gradient-danger text-white animated-card">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="rounded-circle bg-white p-3 me-3">
                                <i class="fas fa-tools text-danger fa-2x"></i>
                            </div>
                            <div>
                                <h5 class="fw-bold mb-1">System Diagnostics</h5>
                                <p class="mb-0">Run comprehensive diagnostics to identify and resolve system issues</p>
                            </div>
                    </div>
                        <button class="btn btn-lg btn-light px-4 shadow-sm" id="runFullDiagnosticsBtn">
                            <i class="fas fa-wrench me-2"></i> Run Full Diagnostics
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Overview Cards -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card h-100 animated-card delay-1">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="stats-icon bg-primary bg-opacity-10">
                            <i class="fas fa-users text-primary"></i>
                        </div>
                        <span class="stat-badge bg-primary rounded-pill shadow-sm">{{ total_users }}</span>
                    </div>
                    <h4 class="fw-bold mb-2">Total Users</h4>
                    <div class="d-flex align-items-center">
                        <div class="progress flex-grow-1 me-2">
                            <div class="progress-bar bg-primary" style="width: 100%"></div>
                        </div>
                        <span class="text-primary fw-bold">100%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card h-100 animated-card delay-2">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="stats-icon bg-success bg-opacity-10">
                            <i class="fas fa-user-check text-success"></i>
    </div>
                        <span class="stat-badge bg-success rounded-pill shadow-sm">{{ active_users }}</span>
                    </div>
                    <h4 class="fw-bold mb-2">Active Users</h4>
                    <div class="d-flex align-items-center">
                        <div class="progress flex-grow-1 me-2">
                            <div class="progress-bar bg-success" style="width: {{ active_users|default:0|floatformat:"0" }}%"></div>
                        </div>
                        <span class="text-success fw-bold">{{ active_users|default:0|floatformat:"0" }}%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card h-100 animated-card delay-3">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="stats-icon bg-info bg-opacity-10">
                            <i class="fas fa-building text-info"></i>
                        </div>
                        <span class="stat-badge bg-info rounded-pill text-white shadow-sm">{{ commercial_accounts }}</span>
                    </div>
                    <h4 class="fw-bold mb-2">Commercial Accounts</h4>
                    <div class="d-flex align-items-center">
                        <div class="progress flex-grow-1 me-2">
                            <div class="progress-bar bg-info" style="width: {{ commercial_accounts|default:0|floatformat:"0" }}%"></div>
                        </div>
                        <span class="text-info fw-bold">{{ commercial_accounts|default:0|floatformat:"0" }}%</span>
            </div>
        </div>
    </div>
</div>

        <div class="col-xl-3 col-md-6">
            <div class="card h-100 animated-card delay-4">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="stats-icon bg-warning bg-opacity-10">
                            <i class="fas fa-clock text-warning"></i>
                        </div>
                        <span class="stat-badge bg-warning rounded-pill shadow-sm">{{ pending_approvals }}</span>
                    </div>
                    <h4 class="fw-bold mb-2">Pending Approvals</h4>
                    <div class="d-flex align-items-center">
                        <div class="progress flex-grow-1 me-2">
                            <div class="progress-bar bg-warning" style="width: {{ pending_approvals|default:0|floatformat:"0" }}%"></div>
                        </div>
                        <span class="text-warning fw-bold">{{ pending_approvals|default:0|floatformat:"0" }}%</span>
            </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Server Analysis & Diagnostics Section -->
    <div class="card mb-4 animated-card shadow-sm">
        <div class="card-header bg-gradient-dark text-white">
            <h5 class="mb-0 fw-bold">
                <i class="fas fa-bug me-2"></i> Server Diagnostics & Error Monitoring
            </h5>
        </div>
        <div class="card-body p-0">
            <ul class="nav nav-tabs" id="diagnosticsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="errors-tab" data-bs-toggle="tab" data-bs-target="#errors-tab-pane" type="button" role="tab" aria-controls="errors-tab-pane" aria-selected="true">
                        <i class="fas fa-exclamation-triangle me-1"></i> Errors
                        <span class="badge bg-danger rounded-pill ms-1">3</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance-tab-pane" type="button" role="tab" aria-controls="performance-tab-pane" aria-selected="false">
                        <i class="fas fa-tachometer-alt me-1"></i> Performance
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security-tab-pane" type="button" role="tab" aria-controls="security-tab-pane" aria-selected="false">
                        <i class="fas fa-shield-alt me-1"></i> Security
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="database-tab" data-bs-toggle="tab" data-bs-target="#database-tab-pane" type="button" role="tab" aria-controls="database-tab-pane" aria-selected="false">
                        <i class="fas fa-database me-1"></i> Database
                    </button>
                </li>
            </ul>
            <div class="tab-content" id="diagnosticsTabsContent">
                <!-- Errors Tab -->
                <div class="tab-pane fade show active p-3" id="errors-tab-pane" role="tabpanel" aria-labelledby="errors-tab" tabindex="0">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h6 class="mb-0">Recent System Errors</h6>
                            <small class="text-muted">View and diagnose recent application errors</small>
                        </div>
                        <button class="btn btn-outline-danger btn-sm" id="refreshErrorsBtn">
                            <i class="fas fa-sync-alt me-1"></i> Refresh
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover table-borderless align-middle mb-0">
                            <thead class="table-dark text-white">
                                <tr>
                                    <th>Time</th>
                                    <th>Type</th>
                                    <th>Location</th>
                                    <th>Error</th>
                                    <th>Status</th>
                                    <th class="text-end">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><small>23:14:53</small></td>
                                    <td><span class="badge bg-danger">Exception</span></td>
                                    <td>urls.py</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-exclamation-circle text-danger me-2"></i>
                                            <span>NoReverseMatch: 'settings_view'</span>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-danger">Unresolved</span></td>
                                    <td class="text-end">
                                        <button type="button" class="btn btn-link p-0" data-bs-toggle="popover" data-bs-html="true" data-bs-title="Error Details" data-bs-content="<div class='small'><strong>Full Error:</strong><br>django.urls.exceptions.NoReverseMatch: Reverse for 'settings_view' not found. 'settings_view' is not a valid view function or pattern name.<br><br><strong>Diagnosis:</strong> URL pattern 'settings_view' is missing from urls.py or may be misspelled. Check the URL configuration or use 'settings' instead.</div>">
                                            <i class="fas fa-info-circle"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><small>23:14:56</small></td>
                                    <td><span class="badge bg-warning text-dark">Method</span></td>
                                    <td>accounts/logout/</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                                            <span>Method Not Allowed (GET)</span>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-info">Diagnosed</span></td>
                                    <td class="text-end">
                                        <button type="button" class="btn btn-link p-0" data-bs-toggle="popover" data-bs-html="true" data-bs-title="Error Details" data-bs-content="<div class='small'><strong>Full Error:</strong><br>Method Not Allowed (GET): /accounts/logout/<br><br><strong>Diagnosis:</strong> The logout endpoint only accepts POST requests for security reasons. Update the logout form to use method='post' or use the POST method for this request.</div>">
                                            <i class="fas fa-info-circle"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><small>23:32:12</small></td>
                                    <td><span class="badge bg-info">Template</span></td>
                                    <td>templates/base.html</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-code text-info me-2"></i>
                                            <span>Missing static files (404)</span>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-success">Fixed</span></td>
                                    <td class="text-end">
                                        <button type="button" class="btn btn-link p-0" data-bs-toggle="popover" data-bs-html="true" data-bs-title="Error Details" data-bs-content="<div class='small'><strong>Full Error:</strong><br>Static file not found: 404 for style.css<br><br><strong>Diagnosis:</strong> Static files were missing or not being served correctly. Issue was fixed by running collectstatic and ensuring DEBUG=True for development.</div>">
                                            <i class="fas fa-info-circle"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <span class="text-muted small">Showing 3 of 3 errors</span>
                        <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#diagnosticsModal">
                            <i class="fas fa-wrench me-1"></i> Run Full Diagnostics
                        </button>
                    </div>
                </div>
                
                <!-- Performance Tab -->
                <div class="tab-pane fade p-3" id="performance-tab-pane" role="tabpanel" aria-labelledby="performance-tab" tabindex="0">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h6 class="mb-0">Performance Metrics</h6>
                            <small class="text-muted">Page load times and server response</small>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                Last 24 Hours
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Last 24 Hours</a></li>
                                <li><a class="dropdown-item" href="#">Last 7 Days</a></li>
                                <li><a class="dropdown-item" href="#">Last 30 Days</a></li>
                            </ul>
                        </div>
            </div>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card bg-dark border-0">
            <div class="card-body">
                                    <h6 class="card-title text-muted">Average Response Time</h6>
                                    <div class="d-flex align-items-center">
                                        <h3 class="me-2 mb-0">247ms</h3>
                                        <span class="badge bg-success">Good</span>
                                    </div>
                                    <div class="mt-3">
                                        <canvas id="responseTimeChart" height="120"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <div class="col-md-6">
                            <div class="card bg-dark border-0">
                                <div class="card-body">
                                    <h6 class="card-title text-muted">Slowest Endpoints</h6>
                                    <div class="mt-2">
                                        <div class="mb-2">
                                            <div class="d-flex justify-content-between mb-1">
                                                <small>/manage/categories/</small>
                                                <small>892ms</small>
                                            </div>
                                            <div class="progress" style="height:8px">
                                                <div class="progress-bar bg-danger" style="width:90%"></div>
                                            </div>
                                        </div>
                                        <div class="mb-2">
                                            <div class="d-flex justify-content-between mb-1">
                                                <small>/manage/users/</small>
                                                <small>512ms</small>
                                            </div>
                                            <div class="progress" style="height:8px">
                                                <div class="progress-bar bg-warning" style="width:60%"></div>
                                            </div>
                                        </div>
                                        <div class="mb-2">
                                            <div class="d-flex justify-content-between mb-1">
                                                <small>/manage/reports/</small>
                                                <small>347ms</small>
                                            </div>
                                            <div class="progress" style="height:8px">
                                                <div class="progress-bar bg-info" style="width:40%"></div>
                                            </div>
                            </div>
                        </div>
                    </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Security Tab -->
                <div class="tab-pane fade p-3" id="security-tab-pane" role="tabpanel" aria-labelledby="security-tab" tabindex="0">
                    <div class="alert alert-success mb-3">
                        <div class="d-flex">
                            <i class="fas fa-shield-alt me-3 fa-2x"></i>
                            <div>
                                <h6 class="alert-heading">Security Status: Good</h6>
                                <p class="mb-0">Last security scan completed on April 12, 2025 at 23:00.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card bg-dark border-0 mb-3">
                        <div class="card-header bg-dark border-bottom border-secondary">
                            <h6 class="mb-0">Security Recommendations</h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush bg-transparent">
                                <div class="list-group-item bg-transparent border-bottom border-secondary py-3">
                                    <div class="d-flex">
                                        <div class="me-3">
                                            <span class="badge bg-warning text-dark p-2">
                                                <i class="fas fa-exclamation-triangle"></i>
                                            </span>
                                        </div>
                                        <div>
                                            <h6 class="mb-1">Enable Content Security Policy (CSP)</h6>
                                            <p class="text-muted small mb-0">Implement CSP headers to prevent XSS attacks</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item bg-transparent border-bottom border-secondary py-3">
                                    <div class="d-flex">
                                        <div class="me-3">
                                            <span class="badge bg-info p-2">
                                                <i class="fas fa-info-circle"></i>
                                            </span>
                                        </div>
                                        <div>
                                            <h6 class="mb-1">Update Django to latest security patch</h6>
                                            <p class="text-muted small mb-0">Current: 5.2, Latest: 5.2.1</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button class="btn btn-primary" type="button">
                            <i class="fas fa-lock me-2"></i>Run Security Scan
                        </button>
                    </div>
                </div>
                
                <!-- Database Tab -->
                <div class="tab-pane fade p-3" id="database-tab-pane" role="tabpanel" aria-labelledby="database-tab" tabindex="0">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h6 class="mb-0">Database Health</h6>
                            <small class="text-muted">Connections and query performance</small>
                        </div>
                        <button class="btn btn-outline-info btn-sm">
                            <i class="fas fa-broom me-1"></i> Optimize
                        </button>
                    </div>
                    
                    <div class="row g-3 mb-3">
                        <div class="col-md-3">
                            <div class="card bg-dark border-0 text-center">
                                <div class="card-body">
                                    <div class="mb-2">
                                        <i class="fas fa-plug fa-2x text-success"></i>
                                    </div>
                                    <h5 class="mb-0">Connected</h5>
                                    <small class="text-success">Healthy</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-dark border-0 text-center">
                                <div class="card-body">
                                    <div class="mb-2">
                                        <i class="fas fa-table fa-2x text-info"></i>
                                    </div>
                                    <h5 class="mb-0">12 Tables</h5>
                                    <small class="text-muted">4 Models</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-dark border-0 text-center">
                                <div class="card-body">
                                    <div class="mb-2">
                                        <i class="fas fa-bolt fa-2x text-warning"></i>
                                    </div>
                                    <h5 class="mb-0">35 ms</h5>
                                    <small class="text-muted">Avg Query Time</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-dark border-0 text-center">
                                <div class="card-body">
                                    <div class="mb-2">
                                        <i class="fas fa-database fa-2x text-primary"></i>
                                    </div>
                                    <h5 class="mb-0">248 KB</h5>
                                    <small class="text-muted">Size</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card bg-dark border-0">
                        <div class="card-header bg-dark border-bottom border-secondary">
                            <h6 class="mb-0">Slow Queries</h6>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-0">No slow queries detected in the last 24 hours.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Admin Actions & Tasks -->
    <div class="row g-4">
        <!-- Admin Actions Panel -->
        <div class="col-lg-5">
            <div class="card h-100 animated-card">
                <div class="card-header">
                    <h5 class="mb-0 fw-bold text-white">
                        <i class="fas fa-cogs me-2"></i> Admin Actions
                    </h5>
                </div>
                <div class="card-body p-3">
                    <div class="list-group list-group-flush admin-action-list">
                        <a href="{% url 'admin_user_list' %}" class="list-group-item action-link list-group-item-action d-flex align-items-center p-3">
                            <div class="rounded-3 bg-primary bg-opacity-10 p-3 me-3">
                                <i class="fas fa-users text-primary"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 fw-bold">Manage Users</h6>
                                <p class="mb-0 text-muted small">View, edit, and delete user accounts</p>
                            </div>
                            <i class="fas fa-arrow-right text-primary"></i>
                        </a>
                        
                        <a href="{% url 'admin_transactions' %}" class="list-group-item action-link list-group-item-action d-flex align-items-center p-3">
                            <div class="rounded-3 bg-success bg-opacity-10 p-3 me-3">
                                <i class="fas fa-exchange-alt text-success"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 fw-bold">Manage Transactions</h6>
                                <p class="mb-0 text-muted small">View and edit all transaction data</p>
                            </div>
                            <i class="fas fa-arrow-right text-success"></i>
                        </a>
                        
                        <a href="{% url 'admin_budgets' %}" class="list-group-item action-link list-group-item-action d-flex align-items-center p-3">
                            <div class="rounded-3 bg-info bg-opacity-10 p-3 me-3">
                                <i class="fas fa-chart-pie text-info"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 fw-bold">Manage Budgets</h6>
                                <p class="mb-0 text-muted small">Control budget allocations for all users</p>
                            </div>
                            <i class="fas fa-arrow-right text-info"></i>
                        </a>
                        
                        <a href="{% url 'admin_goals' %}" class="list-group-item action-link list-group-item-action d-flex align-items-center p-3">
                            <div class="rounded-3 bg-warning bg-opacity-10 p-3 me-3">
                                <i class="fas fa-bullseye text-warning"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 fw-bold">Manage Goals</h6>
                                <p class="mb-0 text-muted small">Edit financial goals for all users</p>
                            </div>
                            <i class="fas fa-arrow-right text-warning"></i>
                        </a>
                        
                        <a href="{% url 'admin_categories' %}" class="list-group-item action-link list-group-item-action d-flex align-items-center p-3">
                            <div class="rounded-3 bg-secondary bg-opacity-10 p-3 me-3">
                                <i class="fas fa-tags text-secondary"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 fw-bold">Manage Categories</h6>
                                <p class="mb-0 text-muted small">Edit and organize transaction categories</p>
                            </div>
                            <i class="fas fa-arrow-right text-secondary"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Admin Tasks -->
        <div class="col-lg-7">
            <div class="card h-100 animated-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-bold text-white">
                        <i class="fas fa-tasks me-2"></i> Admin Tasks
                    </h5>
                    <span class="badge bg-primary px-3 py-2 rounded-3 shadow-sm">4 Tasks</span>
                </div>
                <div class="card-body p-4">
                    <div class="row g-3">
                        <!-- Create New User Task -->
                        <div class="col-md-6">
                            <div class="card h-100 border-0 bg-gradient-primary task-card shadow">
                                <div class="card-body p-4 text-white">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-3 bg-white p-2 me-3 shadow-sm">
                                            <i class="fas fa-user-plus text-primary"></i>
                                        </div>
                                        <h5 class="fw-bold mb-0">Create New User</h5>
                                    </div>
                                    <p class="mb-4">Add a new user account to the system with custom permissions</p>
                                    <a href="{% url 'admin_user_create' %}" class="btn btn-light w-100 shadow-sm">
                                        <i class="fas fa-plus-circle me-2"></i>Add User
                                    </a>
                        </div>
                    </div>
                </div>
                
                        <!-- Manage Admins Task -->
                    <div class="col-md-6">
                            <div class="card h-100 border-0 bg-gradient-danger task-card shadow">
                                <div class="card-body p-4 text-white">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-3 bg-white p-2 me-3 shadow-sm">
                                            <i class="fas fa-user-shield text-danger"></i>
                                        </div>
                                        <h5 class="fw-bold mb-0">Manage Admins</h5>
                                    </div>
                                    <p class="mb-4">Configure admin users and their system permissions</p>
                                    <a href="{% url 'admin_user_list' %}?status=staff" class="btn btn-light w-100 shadow-sm">
                                        <i class="fas fa-key me-2"></i>Configure Access
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- System Tools Task -->
                        <div class="col-md-6">
                            <div class="card h-100 border-0 task-card shadow-sm">
                                <div class="card-body p-4">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-3 bg-warning bg-opacity-10 p-2 me-3 shadow-sm">
                                            <i class="fas fa-tools text-warning"></i>
                                        </div>
                                        <h5 class="fw-bold mb-0">System Tools</h5>
                                    </div>
                                    <p class="mb-4">Advanced tools for analyzing and fixing data issues</p>
                                    <div class="d-flex gap-2">
                                        <a href="{% url 'admin_analyze_transactions' %}" class="btn btn-outline-warning flex-grow-1 shadow-sm">
                                            <i class="fas fa-search me-2"></i>Analyze
                                        </a>
                                        <a href="{% url 'admin_analyze_transactions' %}?fix=true" class="btn btn-warning flex-grow-1 shadow-sm">
                                            <i class="fas fa-wrench me-2"></i>Fix Issues
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                        
                        <!-- Reports Task -->
                    <div class="col-md-6">
                            <div class="card h-100 border-0 task-card shadow-sm">
                                <div class="card-body p-4">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-3 bg-info bg-opacity-10 p-2 me-3 shadow-sm">
                                            <i class="fas fa-chart-bar text-info"></i>
                                        </div>
                                        <h5 class="fw-bold mb-0">Reports & Analytics</h5>
                                    </div>
                                    <p class="mb-4">View detailed system reports and user statistics</p>
                                    <a href="{% url 'admin_reports' %}" class="btn btn-info text-white w-100 shadow-sm">
                                        <i class="fas fa-file-alt me-2"></i>View Reports
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- System Status and Guidelines Section -->
    <div class="row g-4 mt-4">
        <!-- Administrator Guidelines -->
        <div class="col-md-6">
            <div class="card animated-card delay-1 shadow">
                <div class="card-header">
                    <h5 class="mb-0 fw-bold text-white">
                        <i class="fas fa-book me-2"></i> Administrator Guidelines
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="alert alert-info border-0 rounded-3 shadow-sm">
                        <i class="fas fa-info-circle me-2"></i> As an administrator, you're responsible for maintaining the system's integrity and user data security.
                    </div>
                    
                    <h6 class="fw-bold mt-4 mb-3">Key Responsibilities:</h6>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item px-0 d-flex align-items-center py-2 border-0 bg-transparent">
                            <div class="rounded-circle bg-success bg-opacity-10 p-2 me-3 shadow-sm">
                                <i class="fas fa-check text-success"></i>
                            </div>
                            <span>Monitor user activity and transaction patterns</span>
                        </li>
                        <li class="list-group-item px-0 d-flex align-items-center py-2 border-0 bg-transparent">
                            <div class="rounded-circle bg-success bg-opacity-10 p-2 me-3 shadow-sm">
                                <i class="fas fa-check text-success"></i>
                            </div>
                            <span>Respond to user inquiries and support requests</span>
                        </li>
                        <li class="list-group-item px-0 d-flex align-items-center py-2 border-0 bg-transparent">
                            <div class="rounded-circle bg-success bg-opacity-10 p-2 me-3 shadow-sm">
                                <i class="fas fa-check text-success"></i>
                            </div>
                            <span>Regularly review system logs for unusual activity</span>
                        </li>
                    </ul>
                    
                    <div class="alert alert-warning mt-3 border-0 rounded-3 shadow-sm">
                        <i class="fas fa-exclamation-triangle me-2"></i> <strong>Warning:</strong> Modifying user financial data should only be done with explicit permission and full documentation.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- System Status -->
        <div class="col-md-6">
            <div class="card animated-card delay-2 shadow">
                <div class="card-header">
                    <h5 class="mb-0 fw-bold text-white">
                        <i class="fas fa-server me-2"></i> System Status
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="row g-4">
                        <!-- Server Load -->
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div>
                                    <h6 class="mb-0 fw-bold">Server Load</h6>
                                    <small class="text-muted">Current CPU and memory usage</small>
                                </div>
                                <span class="badge bg-success rounded-pill px-3">Healthy</span>
                            </div>
                            <div class="progress mb-3" style="height: 10px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 32%" aria-valuenow="32" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        
                        <!-- Database Health -->
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div>
                                    <h6 class="mb-0 fw-bold">Database Health</h6>
                                    <small class="text-muted">Query performance and response times</small>
                                </div>
                                <span class="badge bg-success rounded-pill px-3">Optimal</span>
                            </div>
                            <div class="progress mb-3" style="height: 10px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 28%" aria-valuenow="28" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        
                        <!-- API Service Status -->
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div>
                                    <h6 class="mb-0 fw-bold">API Service Status</h6>
                                    <small class="text-muted">External services connectivity</small>
                                </div>
                                <span class="badge bg-success rounded-pill px-3">Online</span>
                            </div>
                            <div class="progress mb-3" style="height: 10px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-primary w-100 mt-4 shadow-sm" data-bs-toggle="modal" data-bs-target="#systemLogsModal">
                        <i class="fas fa-list-alt me-2"></i>View System Logs
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Floating Action Button for Diagnostics -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1030;">
    <button class="btn btn-danger btn-lg rounded-circle shadow" id="floatingDiagnosticsBtn" 
            style="width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
        <i class="fas fa-tools"></i>
    </button>
</div>

<!-- System Logs Modal -->
<div class="modal fade" id="systemLogsModal" tabindex="-1" aria-labelledby="systemLogsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header border-bottom border-dark">
                <h5 class="modal-title" id="systemLogsModalLabel">System Logs</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="list-group">
                    {% for i in "12345"|make_list %}
                    <div class="list-group-item list-group-item-action bg-transparent border-bottom border-secondary text-white mb-2">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1 fw-bold">System Event #{{ forloop.counter }}</h6>
                            <small>{{ forloop.counter }} hour{{ forloop.counter|pluralize }} ago</small>
                        </div>
                        {% if forloop.counter == 1 %}
                        <p class="mb-1">User login</p>
                        <span class="badge bg-success rounded-pill">Success</span>
                        {% elif forloop.counter == 2 %}
                        <p class="mb-1">System backup completed</p>
                        <span class="badge bg-success rounded-pill">Complete</span>
                        {% elif forloop.counter == 3 %}
                        <p class="mb-1">API connection reset</p>
                        <span class="badge bg-warning text-dark rounded-pill">Warning</span>
                        {% elif forloop.counter == 4 %}
                        <p class="mb-1">Database optimization finished</p>
                        <span class="badge bg-success rounded-pill">Complete</span>
                        {% elif forloop.counter == 5 %}
                        <p class="mb-1">User account updated</p>
                        <span class="badge bg-success rounded-pill">Success</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="modal-footer border-top border-dark">
                <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">
                    <i class="fas fa-download me-2"></i>Download Logs
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Logout Modal-->
<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"></span>
                </button>
            </div>
            <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                <a class="btn btn-primary" href="login.html">Logout</a>
            </div>
        </div>
    </div>
</div>

<!-- Diagnostics Modal -->
<div class="modal fade" id="diagnosticsModal" tabindex="-1" aria-labelledby="diagnosticsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-light border-0">
            <div class="modal-header border-bottom border-secondary">
                <h5 class="modal-title" id="diagnosticsModalLabel">
                    <i class="fas fa-wrench me-2"></i> System Diagnostics
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <div class="d-flex">
                        <i class="fas fa-exclamation-triangle me-3 fa-2x"></i>
                        <div>
                            <h6 class="alert-heading">Warning: Performance Impact</h6>
                            <p class="mb-0">Running full system diagnostics may temporarily impact system performance. Consider running during off-peak hours.</p>
                        </div>
                    </div>
                </div>
                
                <h6 class="mb-3">Select Diagnostic Tests to Run:</h6>
                
                <div class="list-group mb-4">
                    <label class="list-group-item bg-dark border-secondary">
                        <div class="d-flex align-items-center">
                            <input class="form-check-input me-3" type="checkbox" value="error_analysis" checked>
                            <div>
                                <strong>Error Analysis</strong>
                                <p class="text-muted small mb-0">Scan logs for errors and exceptions, analyze patterns, and suggest fixes</p>
                            </div>
                        </div>
                    </label>
                    <label class="list-group-item bg-dark border-secondary">
                        <div class="d-flex align-items-center">
                            <input class="form-check-input me-3" type="checkbox" value="performance_analysis" checked>
                            <div>
                                <strong>Performance Analysis</strong>
                                <p class="text-muted small mb-0">Analyze response times, identify bottlenecks, and recommend optimizations</p>
                            </div>
                        </div>
                    </label>
                    <label class="list-group-item bg-dark border-secondary">
                        <div class="d-flex align-items-center">
                            <input class="form-check-input me-3" type="checkbox" value="security_scan">
                            <div>
                                <strong>Security Scan</strong>
                                <p class="text-muted small mb-0">Check for vulnerabilities, outdated packages, and suspicious activities</p>
                            </div>
                        </div>
                    </label>
                    <label class="list-group-item bg-dark border-secondary">
                        <div class="d-flex align-items-center">
                            <input class="form-check-input me-3" type="checkbox" value="db_optimization">
                            <div>
                                <strong>Database Optimization</strong>
                                <p class="text-muted small mb-0">Analyze database performance, suggest indexes, and identify slow queries</p>
                            </div>
                        </div>
                    </label>
                    <label class="list-group-item bg-dark border-secondary">
                        <div class="d-flex align-items-center">
                            <input class="form-check-input me-3" type="checkbox" value="storage_cleanup">
                            <div>
                                <strong>Storage Cleanup</strong>
                                <p class="text-muted small mb-0">Find unused files, cleanup temporary data, and optimize storage usage</p>
                            </div>
                        </div>
                    </label>
                </div>
                
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="autoFixToggle">
                    <label class="form-check-label" for="autoFixToggle">Auto-fix issues when possible</label>
                </div>
                
                <div class="form-group mb-3">
                    <label for="diagnosticsEmail" class="form-label">Email Results To:</label>
                    <input type="email" class="form-control bg-dark border-secondary text-light" id="diagnosticsEmail" placeholder="admin@example.com">
                </div>
            </div>
            <div class="modal-footer border-top border-secondary">
                <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="runDiagnosticsBtn">
                    <i class="fas fa-play me-1"></i> Run Diagnostics
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize popovers
        const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]');
        const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl, {
            trigger: 'click',
            html: true
        }));
        
        // Floating Diagnostics Button
        document.getElementById('floatingDiagnosticsBtn')?.addEventListener('click', function() {
            const diagnosticsModal = new bootstrap.Modal(document.getElementById('diagnosticsModal'));
            diagnosticsModal.show();
        });
        
        // Run Full Diagnostics standalone button
        document.getElementById('runFullDiagnosticsBtn')?.addEventListener('click', function() {
            const diagnosticsModal = new bootstrap.Modal(document.getElementById('diagnosticsModal'));
            diagnosticsModal.show();
        });
        
        // System Load History Chart
        const systemLoadCtx = document.getElementById('systemLoadChart');
        if (systemLoadCtx) {
            new Chart(systemLoadCtx, {
                type: 'line',
                data: {
                    labels: ['6h ago', '5h ago', '4h ago', '3h ago', '2h ago', '1h ago', 'Now'],
                    datasets: [{
                        label: 'CPU Usage',
                        data: [28, 32, 36, 45, 40, 38, 32],
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Memory Usage',
                        data: [45, 48, 52, 60, 65, 68, 65],
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#f8f9fa'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#f8f9fa'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#f8f9fa'
                            }
                        }
                    }
                }
            });
        }

        // Server Traffic Chart
        const trafficCtx = document.getElementById('serverTrafficChart');
        if (trafficCtx) {
            new Chart(trafficCtx, {
                type: 'bar',
                data: {
                    labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
                    datasets: [{
                        label: 'API Requests',
                        data: [3200, 3800, 4200, 3900, 4500, 2800, 2500],
                        backgroundColor: 'rgba(40, 167, 69, 0.7)',
                        borderRadius: 5
                    },
                    {
                        label: 'Page Views',
                        data: [4800, 5200, 5700, 5300, 6100, 3900, 3500],
                        backgroundColor: 'rgba(13, 110, 253, 0.7)',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#f8f9fa'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#f8f9fa'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#f8f9fa'
                            }
                        }
                    }
                }
            });
        }
        
        // Response Time Chart
        const responseTimeCtx = document.getElementById('responseTimeChart');
        if (responseTimeCtx) {
            new Chart(responseTimeCtx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', 'Now'],
                    datasets: [{
                        label: 'Response Time (ms)',
                        data: [210, 225, 280, 310, 290, 260, 247],
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#adb5bd',
                                font: {
                                    size: 10
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#adb5bd',
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Initialize counters with animation
        const counters = document.querySelectorAll('.stat-badge');
        counters.forEach(counter => {
            const targetValue = parseInt(counter.textContent) || 0;
            counter.textContent = '0';
            
            let currentValue = 0;
            const increment = targetValue / 30; // Divide by number of steps
            const duration = 1500; // Animation duration in ms
            const steps = 30; // Number of steps
            
            const timer = setInterval(() => {
                currentValue += increment;
                counter.textContent = Math.round(currentValue);
                
                if (currentValue >= targetValue) {
                    counter.textContent = targetValue;
                    clearInterval(timer);
                }
            }, duration / steps);
        });
        
        // Refresh Errors Button
        document.getElementById('refreshErrorsBtn')?.addEventListener('click', function() {
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-circle-notch fa-spin me-1"></i> Refreshing...';
            
            // Simulate loading (in a real app, this would be an actual API call)
            setTimeout(() => {
                this.disabled = false;
                this.innerHTML = '<i class="fas fa-sync-alt me-1"></i> Refresh';
                // Show a toast or notification
                alert('Error logs refreshed!');
            }, 1500);
        });

        // Run Diagnostics Button
        document.getElementById('runDiagnosticsBtn')?.addEventListener('click', function() {
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-circle-notch fa-spin me-1"></i> Running...';
            
            // Get selected tests
            const selectedTests = [];
            document.querySelectorAll('.list-group-item input[type="checkbox"]:checked').forEach(checkbox => {
                selectedTests.push(checkbox.value);
            });
            
            const autoFix = document.getElementById('autoFixToggle').checked;
            const email = document.getElementById('diagnosticsEmail').value;
            
            // Simulate diagnostics running (in a real app, this would be an actual API call)
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                // Update progress if you add a progress bar
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    this.disabled = false;
                    this.innerHTML = '<i class="fas fa-play me-1"></i> Run Diagnostics';
                    
                    // Dismiss modal and show completion message
                    const diagnosticsModal = bootstrap.Modal.getInstance(document.getElementById('diagnosticsModal'));
                    if (diagnosticsModal) {
                        diagnosticsModal.hide();
                        // Add a small delay before showing alert to ensure modal is fully hidden
                        setTimeout(() => {
                            alert('Diagnostics completed! Results have been saved and ' + (email ? 'sent to ' + email : 'are available in the reports section.'));
                        }, 300);
                    }
                }
            }, 500);
        });
    });
</script>
{% endblock %} 