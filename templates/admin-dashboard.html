{% extends "base.html" %}
{% load static %}

{% block title %}Admin Dashboard | Finance Tracker{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/enhanced.css' %}">
{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="container-fluid px-4 py-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0 text-primary">Admin Dashboard</h1>
            <div class="d-flex">
                <button class="btn btn-outline-secondary me-2" data-bs-toggle="tooltip" title="Refresh Data">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#systemLogsModal">
                    <i class="fas fa-list-ul me-2"></i>System Logs
                </button>
            </div>
        </div>

        <!-- System overview cards -->
        <div class="row system-overview g-4 mb-5">
            <div class="col-md-6 col-lg-3">
                <div class="card hover-lift border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="card-subtitle mb-2 text-muted">Total Users</h6>
                                <h2 class="card-title mb-0" id="userCounter">437</h2>
                                <p class="text-success small mt-2">
                                    <i class="fas fa-arrow-up me-1"></i>12% from last month
                                </p>
                            </div>
                            <div class="admin-icon-box bg-primary-light text-primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card hover-lift border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="card-subtitle mb-2 text-muted">Active Users</h6>
                                <h2 class="card-title mb-0" id="activeCounter">138</h2>
                                <p class="text-success small mt-2">
                                    <i class="fas fa-arrow-up me-1"></i>5% from last week
                                </p>
                            </div>
                            <div class="admin-icon-box bg-success-light text-success">
                                <i class="fas fa-user-check"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card hover-lift border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="card-subtitle mb-2 text-muted">Commercial Accounts</h6>
                                <h2 class="card-title mb-0" id="commercialCounter">42</h2>
                                <p class="text-success small mt-2">
                                    <i class="fas fa-arrow-up me-1"></i>18% from last month
                                </p>
                            </div>
                            <div class="admin-icon-box bg-info-light text-info">
                                <i class="fas fa-building"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card hover-lift border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="card-subtitle mb-2 text-muted">Pending Approvals</h6>
                                <h2 class="card-title mb-0" id="pendingCounter">5</h2>
                                <p class="text-warning small mt-2">
                                    <i class="fas fa-arrow-down me-1"></i>2 less than yesterday
                                </p>
                            </div>
                            <div class="admin-icon-box bg-warning-light text-warning">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System status and charts -->
        <div class="row g-4 mb-5">
            <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">System Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-1">
                                <span>CPU Usage</span>
                                <span>45%</span>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 45%;" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-1">
                                <span>Memory Usage</span>
                                <span>68%</span>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 68%;" aria-valuenow="68" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-1">
                                <span>Disk Space</span>
                                <span>32%</span>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 32%;" aria-valuenow="32" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        <div>
                            <div class="d-flex justify-content-between mb-1">
                                <span>Database Load</span>
                                <span>54%</span>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar bg-primary" role="progressbar" style="width: 54%;" aria-valuenow="54" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-white border-0">
                        <small class="text-muted">Last updated: Today at 16:45</small>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">System Load History</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="systemLoadChart" height="250"></canvas>
                    </div>
                    <div class="card-footer bg-white border-0">
                        <small class="text-muted">Data refreshes every 10 minutes</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent activity and traffic stats -->
        <div class="row g-4 mb-5">
            <div class="col-md-8">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">Server Traffic</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="serverTrafficChart" height="250"></canvas>
                    </div>
                    <div class="card-footer bg-white border-0">
                        <small class="text-muted">Past 7 days</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Quick Actions</h5>
                        <button class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="list-group">
                            <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center border-0 px-0">
                                <div>
                                    <i class="fas fa-database me-2 text-primary"></i>
                                    Backup Database
                                </div>
                                <span class="badge bg-secondary rounded-pill" data-bs-toggle="tooltip" title="Last run: Today at 03:00">
                                    <i class="fas fa-check"></i>
                                </span>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center border-0 px-0">
                                <div>
                                    <i class="fas fa-envelope me-2 text-info"></i>
                                    Send System Report
                                </div>
                                <span class="badge bg-secondary rounded-pill">
                                    <i class="fas fa-chevron-right"></i>
                                </span>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center border-0 px-0">
                                <div>
                                    <i class="fas fa-user-shield me-2 text-warning"></i>
                                    Security Audit
                                </div>
                                <span class="badge bg-warning rounded-pill" data-bs-toggle="tooltip" title="Last run: 7 days ago">
                                    <i class="fas fa-exclamation"></i>
                                </span>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center border-0 px-0">
                                <div>
                                    <i class="fas fa-trash-alt me-2 text-danger"></i>
                                    Clean Temporary Files
                                </div>
                                <span class="badge bg-secondary rounded-pill">
                                    <i class="fas fa-chevron-right"></i>
                                </span>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center border-0 px-0">
                                <div>
                                    <i class="fas fa-cogs me-2 text-secondary"></i>
                                    System Settings
                                </div>
                                <span class="badge bg-secondary rounded-pill">
                                    <i class="fas fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Logs Modal -->
<div class="modal fade" id="systemLogsModal" tabindex="-1" aria-labelledby="systemLogsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="systemLogsModalLabel">System Logs</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search logs...">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="btn-group mb-3 w-100">
                    <button type="button" class="btn btn-outline-primary active">All</button>
                    <button type="button" class="btn btn-outline-primary">Info</button>
                    <button type="button" class="btn btn-outline-primary">Warning</button>
                    <button type="button" class="btn btn-outline-primary">Error</button>
                </div>
                <div id="systemLogsContent" class="logs-container">
                    <!-- Sample logs with Indian Rupee (₹) -->
                    <div class="log-item border-bottom py-2">
                        <div class="d-flex justify-content-between">
                            <div>
                                <span class="badge bg-success">SUCCESS</span>
                                <span>Transaction completed: ₹25,000 deposit</span>
                            </div>
                            <small class="text-muted">Today, 14:25</small>
                        </div>
                    </div>
                    <div class="log-item border-bottom py-2">
                        <div class="d-flex justify-content-between">
                            <div>
                                <span class="badge bg-info">INFO</span>
                                <span>Account balance updated: ₹1,75,500</span>
                            </div>
                            <small class="text-muted">Today, 13:42</small>
                        </div>
                    </div>
                    <div class="log-item border-bottom py-2">
                        <div class="d-flex justify-content-between">
                            <div>
                                <span class="badge bg-warning">WARNING</span>
                                <span>Large withdrawal detected: ₹50,000</span>
                            </div>
                            <small class="text-muted">Today, 11:17</small>
                        </div>
                    </div>
                    <div class="log-item border-bottom py-2">
                        <div class="d-flex justify-content-between">
                            <div>
                                <span class="badge bg-danger">ERROR</span>
                                <span>Failed transaction: ₹35,000 transfer</span>
                            </div>
                            <small class="text-muted">Today, 10:03</small>
                        </div>
                    </div>
                    <div class="log-item py-2">
                        <div class="d-flex justify-content-between">
                            <div>
                                <span class="badge bg-success">SUCCESS</span>
                                <span>Monthly report generated: ₹4,25,000 in transactions</span>
                            </div>
                            <small class="text-muted">Yesterday, 23:00</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Export Logs</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add rupee symbol to all currency values
    const addRupeeSymbol = () => {
        const currencyElements = document.querySelectorAll('.currency-value');
        currencyElements.forEach(el => {
            const value = el.textContent;
            if (!value.startsWith('₹')) {
                el.textContent = '₹' + value;
            }
        });
    };
    
    addRupeeSymbol();

    // Update any dynamically added currency elements
    const observer = new MutationObserver(function(mutations) {
        addRupeeSymbol();
    });
    
    observer.observe(document.body, { childList: true, subtree: true });
});
</script>
<script src="{% static 'js/admin-dashboard.js' %}"></script>
{% endblock %} 